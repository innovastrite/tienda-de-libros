{% extends "catalogo/base.html" %}

{% block content %}
<div class="container mt-3">
    <!-- Sección de anuncios -->
    {% if anuncios %}
    <div class="container-fluid px-0">
        <div class="row mb-4">
            {% for anuncio in anuncios %}
            <div class="col-12">
                <div class="card">
                    {% if anuncio.imagen %}
                    <div style="width: 100%; height: 170px; position: relative;">
                        <img src="{{ anuncio.imagen.url }}" 
                             alt="{{ anuncio.titulo }}"
                             style="width: 100%; 
                                    height: 100%; 
                                    object-fit: cover; 
                                    object-position: center;">
                    </div>
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ anuncio.titulo }}</h5>
                        <p class="card-text">{{ anuncio.descripcion }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="row">
        <!-- Lista de libros -->
        <div class="col-md-12">
            <div class="row">
                {% for libro in libros %}
                <div class="col-md-4 mb-3">
                    <div class="card h-100 {% if libro.publicidad_activa %}border border-primary{% endif %}">
                        <!-- Portada -->
                        <div style="height: {% if libro.publicidad_activa %}315px{% else %}300px{% endif %}; transition: height 0.3s ease;">
                            {% if libro.portada %}
                            <img src="{{ libro.portada.url }}" 
                                 class="card-img-top" 
                                 alt="{{ libro.titulo }}" 
                                 style="height: 100%; 
                                        width: 100%; 
                                        object-fit: cover;">
                            {% endif %}
                        </div>
                        <!-- Información del libro -->
                        <div class="card-body p-2">
                            <!-- Título del libro -->
                            <h5 class="card-title" style="font-size: 1.7rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 0.6rem;">
                                {{ libro.titulo }}
                            </h5>
                            <!-- Autor -->
                            <p class="card-text" style="font-size: 1.2rem; color: #555; margin-bottom: 0.2rem;">
                                Autor: {{ libro.autor }}
                            </p>
                            <!-- Categoría -->
                            <p class="card-text" style="font-size: 1.2rem; color: #555; margin-bottom: 0.2rem;">
                                Categoría: {{ libro.categoria.nombre }}
                            </p>
                            <!-- Precio o etiqueta de gratuito -->
                            <p class="card-text" style="font-size: 1.3rem; color: #333; margin-bottom: 0.4rem;">
                                {% if libro.es_gratis %}
                                <span class="badge bg-success">Gratis</span>
                                {% else %}
                                Precio: ${{ libro.precio }}
                                {% endif %}
                            </p>
                            <!-- Destacado -->
                            {% if libro.publicidad_activa %}
                            <span class="badge bg-primary">Destacado</span>
                            {% endif %}
                            <!-- Botones -->
                            <div class="mt-3">
                                <a href="{% url 'detalle_libro' libro.id %}" class="btn btn-sm btn-primary">Ver más</a>
                                {% if not libro.es_gratis and libro.activo %}
                                <a href="{% url 'registrar_venta' libro.id %}" class="btn btn-sm btn-success">Comprar</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <div class="alert alert-info">
                        No hay libros disponibles.
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Paginación -->
            {% if libros.paginator.num_pages > 1 %}
            <nav aria-label="Navegación de páginas" class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if libros.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ libros.previous_page_number }}">Anterior</a>
                    </li>
                    {% endif %}
                    
                    {% for num in libros.paginator.page_range %}
                    <li class="page-item {% if libros.number == num %}active{% endif %}">
                        <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                    </li>
                    {% endfor %}
                    
                    {% if libros.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ libros.next_page_number }}">Siguiente</a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
